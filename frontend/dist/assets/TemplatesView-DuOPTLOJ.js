import{x as $,k as P,l as z,w as s,r as i,o as u,a as l,b as n,g as d,c as b,F as E,m as G,t as y,u as Q,d as M,e as X,f as T,v as D,z as q,A as Y}from"./index-B2-RunWW.js";import{u as Z,a as h,A as ee}from"./AppShell-CflNe7-M.js";import{_ as te}from"./WowCard-Cmy-HL6C.js";import{_ as p}from"./WowButton-B3DY_ja0.js";import{_ as j}from"./WowModal-CCoTxtnT.js";import{_ as le,a as ae}from"./RealmBadge-CFQI9HTC.js";import{u as se}from"./useWowIcons-CHrwIOWq.js";const oe=m=>$.get(`/guilds/${m}/templates`),re=(m,r)=>$.post(`/guilds/${m}/templates`,r),de=(m,r,v)=>$.put(`/guilds/${m}/templates/${r}`,v),ne=(m,r)=>$.delete(`/guilds/${m}/templates/${r}`),ie=(m,r,v)=>$.post(`/guilds/${m}/templates/${r}/apply`,v),ue={class:"p-4 md:p-6 space-y-6"},me={class:"flex items-center justify-between"},pe={key:0,class:"space-y-3"},ve={key:1,class:"p-4 rounded-lg bg-red-900/30 border border-red-600 text-red-300"},fe={key:2,class:"text-center py-12 text-text-muted"},xe={key:3,class:"space-y-3"},ce={class:"flex items-center gap-4"},be=["src","alt"],ye={class:"flex-1 min-w-0"},ge={class:"flex items-center gap-2 flex-wrap"},ke={class:"font-bold text-text-primary"},we={class:"text-xs text-text-muted mt-1"},Te={class:"flex items-center gap-2 flex-shrink-0"},_e={class:"grid grid-cols-2 gap-4"},Ce=["value"],Ve={key:0,class:"p-3 rounded bg-red-900/30 border border-red-600 text-red-300 text-sm"},$e={class:"flex justify-end gap-3"},Se={class:"space-y-4"},ze={class:"text-text-muted text-sm"},De={class:"text-text-primary"},Ne={class:"flex justify-end gap-3"},Ue={class:"text-text-muted"},Ae={class:"text-text-primary"},Ee={class:"flex justify-end gap-3"},Ie={__name:"TemplatesView",setup(m){const r=Z(),v=h(),{getRaidIcon:B}=se(),x=i([]),N=i(!0),f=i(!1),U=i(null),g=i(null),w=i(!1),_=i(!1),C=i(!1),c=i(null),A=i(null),S=i(null),V=i(""),R=[{value:"naxx",label:"Naxxramas"},{value:"os",label:"Obsidian Sanctum"},{value:"eoe",label:"Eye of Eternity"},{value:"voa",label:"Vault of Archavon"},{value:"ulduar",label:"Ulduar"},{value:"toc",label:"Trial of the Crusader"},{value:"icc",label:"Icecrown Citadel"},{value:"rs",label:"Ruby Sanctum"}],o=Y({name:"",raid_type:"",size:"",realm:"",description:""});P(async()=>{N.value=!0,r.currentGuild||await r.fetchGuilds();try{x.value=await oe(r.currentGuild.id)}catch{U.value="Failed to load templates"}finally{N.value=!1}});function I(){c.value=null,Object.assign(o,{name:"",raid_type:"",size:"",realm:"",description:""}),g.value=null,w.value=!0}function O(a){c.value=a,Object.assign(o,{name:a.name,raid_type:a.raid_type,size:a.size??"",realm:a.realm??"",description:a.description??""}),g.value=null,w.value=!0}function H(a){A.value=a,V.value="",_.value=!0}function L(a){S.value=a,C.value=!0}async function F(){var a,e;if(g.value=null,!o.name||!o.raid_type){g.value="Name and raid type are required";return}f.value=!0;try{if(c.value){const t=await de(r.currentGuild.id,c.value.id,o),k=x.value.findIndex(K=>K.id===c.value.id);k!==-1&&(x.value[k]=t)}else x.value.push(await re(r.currentGuild.id,o));w.value=!1,v.showToast(c.value?"Template updated":"Template created","success")}catch(t){g.value=((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)??"Failed to save"}finally{f.value=!1}}async function W(){var a,e;if(V.value){f.value=!0;try{await ie(r.currentGuild.id,A.value.id,{start_time:V.value}),_.value=!1,v.showToast("Event scheduled from template!","success")}catch(t){v.showToast(((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)??"Failed to apply template","error")}finally{f.value=!1}}}async function J(){f.value=!0;try{await ne(r.currentGuild.id,S.value.id),x.value=x.value.filter(a=>a.id!==S.value.id),C.value=!1,v.showToast("Template deleted","success")}catch{v.showToast("Failed to delete","error")}finally{f.value=!1}}return(a,e)=>(u(),z(ee,null,{default:s(()=>[l("div",ue,[l("div",me,[e[13]||(e[13]=l("div",null,[l("h1",{class:"wow-heading text-2xl"},"Raid Templates"),l("p",{class:"text-text-muted text-sm mt-0.5"},"Save recurring raid schedules as templates")],-1)),n(p,{onClick:I},{default:s(()=>[...e[12]||(e[12]=[l("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),d(" New Template ",-1)])]),_:1})]),N.value?(u(),b("div",pe,[(u(),b(E,null,G(3,t=>l("div",{key:t,class:"h-20 rounded-lg bg-bg-secondary border border-border-default loading-pulse"})),64))])):U.value?(u(),b("div",ve,y(U.value),1)):x.value.length===0?(u(),b("div",fe," No templates yet. Create a template to quickly schedule recurring raids. ")):(u(),b("div",xe,[(u(!0),b(E,null,G(x.value,t=>(u(),z(te,{key:t.id},{default:s(()=>[l("div",ce,[l("img",{src:Q(B)(t.raid_type),alt:t.raid_type,class:"w-12 h-12 rounded border border-border-default flex-shrink-0"},null,8,be),l("div",ye,[l("div",ge,[l("span",ke,y(t.name),1),t.size?(u(),z(le,{key:0,size:t.size},null,8,["size"])):M("",!0),t.realm?(u(),z(ae,{key:1,realm:t.realm},null,8,["realm"])):M("",!0)]),l("div",we,y(t.description??"No description"),1)]),l("div",Te,[n(p,{variant:"secondary",class:"text-xs py-1.5",onClick:k=>H(t)},{default:s(()=>[...e[14]||(e[14]=[d(" Apply ",-1)])]),_:1},8,["onClick"]),n(p,{variant:"secondary",class:"text-xs py-1.5",onClick:k=>O(t)},{default:s(()=>[...e[15]||(e[15]=[d(" Edit ",-1)])]),_:1},8,["onClick"]),n(p,{variant:"danger",class:"text-xs py-1.5 px-2",onClick:k=>L(t)},{default:s(()=>[...e[16]||(e[16]=[d("✕",-1)])]),_:1},8,["onClick"])])])]),_:2},1024))),128))]))]),n(j,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=t=>w.value=t),title:c.value?"Edit Template":"New Template",size:"md"},{footer:s(()=>[l("div",$e,[n(p,{variant:"secondary",onClick:e[5]||(e[5]=t=>w.value=!1)},{default:s(()=>[...e[24]||(e[24]=[d("Cancel",-1)])]),_:1}),n(p,{loading:f.value,onClick:F},{default:s(()=>[d(y(c.value?"Save":"Create"),1)]),_:1},8,["loading"])])]),default:s(()=>[l("form",{onSubmit:X(F,["prevent"]),class:"space-y-4"},[l("div",null,[e[17]||(e[17]=l("label",{class:"block text-xs text-text-muted mb-1"},"Template Name *",-1)),T(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.name=t),required:"",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},null,512),[[D,o.name]])]),l("div",_e,[l("div",null,[e[19]||(e[19]=l("label",{class:"block text-xs text-text-muted mb-1"},"Raid Type *",-1)),T(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.raid_type=t),required:"",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},[e[18]||(e[18]=l("option",{value:""},"Select…",-1)),(u(),b(E,null,G(R,t=>l("option",{key:t.value,value:t.value},y(t.label),9,Ce)),64))],512),[[q,o.raid_type]])]),l("div",null,[e[21]||(e[21]=l("label",{class:"block text-xs text-text-muted mb-1"},"Size",-1)),T(l("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.size=t),class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},[...e[20]||(e[20]=[l("option",{value:""},"Select…",-1),l("option",{value:10},"10-man",-1),l("option",{value:25},"25-man",-1)])],512),[[q,o.size,void 0,{number:!0}]])])]),l("div",null,[e[22]||(e[22]=l("label",{class:"block text-xs text-text-muted mb-1"},"Realm",-1)),T(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.realm=t),class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},null,512),[[D,o.realm]])]),l("div",null,[e[23]||(e[23]=l("label",{class:"block text-xs text-text-muted mb-1"},"Description",-1)),T(l("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.description=t),rows:"2",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none resize-none"},null,512),[[D,o.description]])]),g.value?(u(),b("div",Ve,y(g.value),1)):M("",!0)],32)]),_:1},8,["modelValue","title"]),n(j,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=t=>_.value=t),title:"Apply Template",size:"sm"},{footer:s(()=>[l("div",Ne,[n(p,{variant:"secondary",onClick:e[8]||(e[8]=t=>_.value=!1)},{default:s(()=>[...e[28]||(e[28]=[d("Cancel",-1)])]),_:1}),n(p,{loading:f.value,onClick:W},{default:s(()=>[...e[29]||(e[29]=[d("Schedule",-1)])]),_:1},8,["loading"])])]),default:s(()=>{var t;return[l("div",Se,[l("p",ze,[e[25]||(e[25]=d("Schedule a new event from template ",-1)),l("strong",De,y((t=A.value)==null?void 0:t.name),1),e[26]||(e[26]=d(".",-1))]),l("div",null,[e[27]||(e[27]=l("label",{class:"block text-xs text-text-muted mb-1"},"Event Date & Time *",-1)),T(l("input",{"onUpdate:modelValue":e[7]||(e[7]=k=>V.value=k),type:"datetime-local",required:"",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},null,512),[[D,V.value]])])])]}),_:1},8,["modelValue"]),n(j,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=t=>C.value=t),title:"Delete Template",size:"sm"},{footer:s(()=>[l("div",Ee,[n(p,{variant:"secondary",onClick:e[10]||(e[10]=t=>C.value=!1)},{default:s(()=>[...e[32]||(e[32]=[d("Cancel",-1)])]),_:1}),n(p,{variant:"danger",loading:f.value,onClick:J},{default:s(()=>[...e[33]||(e[33]=[d("Delete",-1)])]),_:1},8,["loading"])])]),default:s(()=>{var t;return[l("p",Ue,[e[30]||(e[30]=d("Delete template ",-1)),l("strong",Ae,y((t=S.value)==null?void 0:t.name),1),e[31]||(e[31]=d("?",-1))])]}),_:1},8,["modelValue"])]),_:1}))}};export{Ie as default};
