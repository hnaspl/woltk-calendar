import{o as r,c as d,F as h,m as b,l as k,w as _,a as s,y as A,t as f,i as $,b as y,d as D,x as M,k as U,q as B,r as g,f as G,z as L}from"./index-B2-RunWW.js";import{u as V,A as z}from"./AppShell-CflNe7-M.js";import{_ as S}from"./WowCard-Cmy-HL6C.js";import{_ as E}from"./ClassBadge-CR9v84wO.js";import{_ as I}from"./WowTooltip-D3rLtXsf.js";import{g as F}from"./events-CGIxMRf0.js";import"./useWowIcons-CHrwIOWq.js";const R={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},P={class:"text-xs text-text-muted mt-1"},T={__name:"AttendanceSummary",props:{records:{type:Array,default:()=>[]},events:{type:Array,default:()=>[]}},setup(u){const o=u,p=$(()=>{const c=o.events.length,a=o.records.filter(n=>n.attended).length,e=c>0?Math.round(a/c*100):0,t=o.records.filter(n=>n.attended).length,l=o.records.filter(n=>!n.attended).length;return o.records.filter(n=>n.bench).length,[{label:"Total Raids",value:c,color:"text-accent-blue"},{label:"Attended",value:t,color:"text-green-400"},{label:"Absent",value:l,color:"text-red-400"},{label:"Attendance Rate",value:`${e}%`,color:e>=75?"text-green-400":e>=50?"text-yellow-400":"text-red-400"}]});return(c,a)=>(r(),d("div",R,[(r(!0),d(h,null,b(p.value,e=>(r(),k(S,{key:e.label,class:"text-center"},{default:_(()=>[s("div",{class:A(["text-2xl font-bold",e.color])},f(e.value),3),s("div",P,f(e.label),1)]),_:2},1024))),128))]))}},j={class:"overflow-x-auto"},q={class:"w-full text-sm"},H={class:"bg-bg-tertiary border-b border-border-default"},J={class:"truncate max-w-[70px] mx-auto"},K={class:"divide-y divide-border-default"},O={class:"px-4 py-2.5 font-medium text-text-primary"},Q={class:"px-4 py-2.5"},W={key:0,class:"inline-block w-5 h-5 rounded-full bg-green-500/20 border border-green-500 text-green-400 text-xs leading-5",title:"Present"},X={key:1,class:"inline-block w-5 h-5 rounded-full bg-red-500/20 border border-red-500 text-red-400 text-xs leading-5",title:"Absent"},Y={key:2,class:"text-border-default"},Z={class:"px-4 py-2.5 text-center"},ee={key:0},te=["colspan"],se={__name:"AttendanceTable",props:{records:{type:Array,default:()=>[]},events:{type:Array,default:()=>[]},signups:{type:Array,default:()=>[]}},setup(u){const o=u;function p(a){return a?new Date(a).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"?"}const c=$(()=>{const a=new Map;return o.signups.forEach(e=>{var l,n,x;const t=e.character_id??((l=e.character)==null?void 0:l.id);t&&(a.has(t)||a.set(t,{characterId:t,characterName:((n=e.character)==null?void 0:n.name)??"?",class:((x=e.character)==null?void 0:x.class)??"",attended:new Set,signedUp:new Set}),a.get(t).signedUp.add(e.event_id))}),o.records.forEach(e=>{var l,n;const t=e.character_id;t&&(a.has(t)||a.set(t,{characterId:t,characterName:((l=e.character)==null?void 0:l.name)??"?",class:((n=e.character)==null?void 0:n.class)??"",attended:new Set,signedUp:new Set}),e.attended&&a.get(t).attended.add(e.event_id))}),Array.from(a.values()).map(e=>{const t=e.signedUp.size||1,l=Math.round(e.attended.size/t*100);return{...e,pct:l}}).sort((e,t)=>t.pct-e.pct)});return(a,e)=>(r(),k(S,{padded:!1},{default:_(()=>[s("div",j,[s("table",q,[s("thead",null,[s("tr",H,[e[0]||(e[0]=s("th",{class:"text-left px-4 py-3 text-xs text-text-muted uppercase tracking-wider"},"Character",-1)),e[1]||(e[1]=s("th",{class:"text-left px-4 py-3 text-xs text-text-muted uppercase tracking-wider"},"Class",-1)),(r(!0),d(h,null,b(u.events,t=>(r(),d("th",{key:t.id,class:"text-center px-2 py-3 text-xs text-text-muted min-w-[80px]"},[y(I,{text:t.title,position:"bottom"},{default:_(()=>[s("div",J,f(p(t.date??t.start_time)),1)]),_:2},1032,["text"])]))),128)),e[2]||(e[2]=s("th",{class:"text-center px-4 py-3 text-xs text-text-muted uppercase tracking-wider"},"%",-1))])]),s("tbody",K,[(r(!0),d(h,null,b(c.value,t=>(r(),d("tr",{key:t.characterId,class:"hover:bg-bg-tertiary/50 transition-colors"},[s("td",O,f(t.characterName),1),s("td",Q,[y(E,{"class-name":t.class},null,8,["class-name"])]),(r(!0),d(h,null,b(u.events,l=>(r(),d("td",{key:l.id,class:"px-2 py-2.5 text-center"},[t.attended.has(l.id)?(r(),d("span",W,"✓")):t.signedUp.has(l.id)?(r(),d("span",X,"✗")):(r(),d("span",Y,"–"))]))),128)),s("td",Z,[s("span",{class:A(["font-semibold",t.pct>=75?"text-green-400":t.pct>=50?"text-yellow-400":"text-red-400"])},f(t.pct)+"%",3)])]))),128)),c.value.length===0?(r(),d("tr",ee,[s("td",{colspan:u.events.length+3,class:"px-4 py-8 text-center text-text-muted"}," No attendance data available. ",8,te)])):D("",!0)])])])]),_:1}))}},ae=(u,o={})=>M.get(`/guilds/${u}/attendance`,{params:o}),re={class:"p-4 md:p-6 space-y-6"},ne={class:"flex items-center justify-between"},le={class:"flex items-center gap-3"},de={key:0,class:"space-y-4"},oe={key:1,class:"p-4 rounded-lg bg-red-900/30 border border-red-600 text-red-300"},fe={__name:"AttendanceView",setup(u){const o=V(),p=g(!0),c=g(null),a=g("30"),e=g([]),t=g([]),l=g([]);U(()=>n()),B(a,n);async function n(){var i,v,w;p.value=!0,c.value=null,o.currentGuild||await o.fetchGuilds();const x=(i=o.currentGuild)==null?void 0:i.id;if(!x){p.value=!1;return}try{const m=a.value!=="all"?{days:a.value}:{},[C,N]=await Promise.all([ae(x,m),F(x,{status:"completed",...m})]);e.value=C,t.value=N}catch(m){c.value=((w=(v=m==null?void 0:m.response)==null?void 0:v.data)==null?void 0:w.message)??"Failed to load attendance data"}finally{p.value=!1}}return(x,i)=>(r(),k(z,null,{default:_(()=>[s("div",re,[s("div",ne,[i[2]||(i[2]=s("h1",{class:"wow-heading text-2xl"},"Attendance",-1)),s("div",le,[G(s("select",{"onUpdate:modelValue":i[0]||(i[0]=v=>a.value=v),class:"bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},[...i[1]||(i[1]=[s("option",{value:"30"},"Last 30 days",-1),s("option",{value:"60"},"Last 60 days",-1),s("option",{value:"90"},"Last 90 days",-1),s("option",{value:"all"},"All time",-1)])],512),[[L,a.value]])])]),p.value?(r(),d("div",de,[...i[3]||(i[3]=[s("div",{class:"h-24 rounded-lg bg-bg-secondary border border-border-default loading-pulse"},null,-1),s("div",{class:"h-64 rounded-lg bg-bg-secondary border border-border-default loading-pulse"},null,-1)])])):c.value?(r(),d("div",oe,f(c.value),1)):(r(),d(h,{key:2},[y(T,{records:e.value,events:t.value},null,8,["records","events"]),y(se,{records:e.value,events:t.value,signups:l.value},null,8,["records","events","signups"])],64))])]),_:1}))}};export{fe as default};
