import{k as P,l as w,w as r,r as u,o,a as l,b as d,g as n,c,F as S,m as $,t as x,d as _,u as R,e as W,f as A,v as T,z as N,A as O}from"./index-B2-RunWW.js";import{u as K,a as L,A as Y}from"./AppShell-CflNe7-M.js";import{_ as J}from"./WowCard-Cmy-HL6C.js";import{_ as m}from"./WowButton-B3DY_ja0.js";import{_ as j}from"./WowModal-CCoTxtnT.js";import{_ as Q}from"./ClassBadge-CR9v84wO.js";import{g as X,_ as Z,a as ee,s as te,u as le,c as ae,b as se}from"./SpecBadge-CY34S-s7.js";import{u as re}from"./useWowIcons-CHrwIOWq.js";const oe={class:"p-4 md:p-6 space-y-6"},de={class:"flex items-center justify-between"},ne={key:0,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},ie={key:1,class:"p-4 rounded-lg bg-red-900/30 border border-red-600 text-red-300"},ue={key:2,class:"text-center py-12 text-text-muted"},ce={key:3,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},me={key:0,class:"absolute top-3 right-3 text-[10px] font-bold text-accent-gold bg-accent-gold/10 border border-accent-gold/30 px-1.5 py-0.5 rounded"},ve={class:"flex items-center gap-3 mb-3"},pe=["src","alt"],fe={class:"font-bold text-text-primary"},xe={class:"text-xs text-text-muted"},be={class:"flex flex-wrap gap-1.5 mb-4"},ge={class:"flex gap-2"},ye=["value"],ke={key:0,class:"p-3 rounded bg-red-900/30 border border-red-600 text-red-300 text-sm"},Ce={class:"flex justify-end gap-3"},we={class:"text-text-muted"},_e={class:"text-text-primary"},Ae={class:"flex justify-end gap-3"},Ne={__name:"CharacterManagerView",setup(Me){const v=K(),b=L(),{getClassIcon:E}=re(),i=u([]),V=u(!0),g=u(!1),h=u(null),p=u(null),y=u(!1),C=u(!1),f=u(null),M=u(null),B=["Death Knight","Druid","Hunter","Mage","Paladin","Priest","Rogue","Shaman","Warlock","Warrior"],s=O({name:"",class:"",realm:"",role:"",spec:""});P(async()=>{var a;V.value=!0,v.currentGuild||await v.fetchGuilds();try{i.value=await X((a=v.currentGuild)==null?void 0:a.id)}catch{h.value="Failed to load characters"}finally{V.value=!1}});function G(){f.value=null,Object.assign(s,{name:"",class:"",realm:"",role:"",spec:""}),p.value=null,y.value=!0}function D(a){f.value=a,Object.assign(s,{name:a.name,class:a.class,realm:a.realm,role:a.role??"",spec:a.spec??""}),p.value=null,y.value=!0}function I(a){M.value=a,C.value=!0}async function U(){var a,e;if(p.value=null,!s.name||!s.class||!s.realm){p.value="Name, class and realm are required";return}g.value=!0;try{const t={name:s.name,class:s.class,realm:s.realm,role:s.role||void 0,spec:s.spec||void 0};if(f.value){const k=await le(v.currentGuild.id,f.value.id,t),F=i.value.findIndex(z=>z.id===f.value.id);F!==-1&&(i.value[F]=k),b.showToast("Character updated","success")}else{const k=await ae(v.currentGuild.id,t);i.value.push(k),b.showToast("Character added","success")}y.value=!1}catch(t){p.value=((e=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:e.message)??"Failed to save character"}finally{g.value=!1}}async function q(a){try{await te(v.currentGuild.id,a.id),i.value.forEach(e=>{e.is_main=e.id===a.id}),b.showToast(`${a.name} set as main`,"success")}catch{b.showToast("Failed to set main","error")}}async function H(){g.value=!0;try{await se(v.currentGuild.id,M.value.id),i.value=i.value.filter(a=>a.id!==M.value.id),C.value=!1,b.showToast("Character archived","success")}catch{b.showToast("Failed to archive character","error")}finally{g.value=!1}}return(a,e)=>(o(),w(Y,null,{default:r(()=>[l("div",oe,[l("div",de,[e[10]||(e[10]=l("h1",{class:"wow-heading text-2xl"},"My Characters",-1)),d(m,{onClick:G},{default:r(()=>[...e[9]||(e[9]=[l("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),n(" Add Character ",-1)])]),_:1})]),V.value?(o(),c("div",ne,[(o(),c(S,null,$(3,t=>l("div",{key:t,class:"h-24 rounded-lg bg-bg-secondary border border-border-default loading-pulse"})),64))])):h.value?(o(),c("div",ie,x(h.value),1)):i.value.length===0?(o(),c("div",ue,[e[12]||(e[12]=l("p",{class:"mb-4"},"You haven't added any characters yet.",-1)),d(m,{onClick:G},{default:r(()=>[...e[11]||(e[11]=[n("Add your first character",-1)])]),_:1})])):(o(),c("div",ce,[(o(!0),c(S,null,$(i.value,t=>(o(),w(J,{key:t.id,gold:t.is_main,class:"relative"},{default:r(()=>[t.is_main?(o(),c("span",me,"MAIN")):_("",!0),l("div",ve,[l("img",{src:R(E)(t.class),alt:t.class,class:"w-12 h-12 rounded border border-border-default"},null,8,pe),l("div",null,[l("div",fe,x(t.name),1),l("div",xe,x(t.realm),1)])]),l("div",be,[d(Q,{"class-name":t.class},null,8,["class-name"]),t.role?(o(),w(Z,{key:0,role:t.role},null,8,["role"])):_("",!0),t.spec?(o(),w(ee,{key:1,spec:t.spec},null,8,["spec"])):_("",!0)]),l("div",ge,[t.is_main?_("",!0):(o(),w(m,{key:0,variant:"secondary",class:"flex-1 text-xs py-1.5",onClick:k=>q(t)},{default:r(()=>[...e[13]||(e[13]=[n("Set Main",-1)])]),_:1},8,["onClick"])),d(m,{variant:"secondary",class:"flex-1 text-xs py-1.5",onClick:k=>D(t)},{default:r(()=>[...e[14]||(e[14]=[n("Edit",-1)])]),_:1},8,["onClick"]),d(m,{variant:"danger",class:"text-xs py-1.5 px-3",onClick:k=>I(t)},{default:r(()=>[...e[15]||(e[15]=[n("✕",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["gold"]))),128))]))]),d(j,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=t=>y.value=t),title:f.value?"Edit Character":"Add Character",size:"md"},{footer:r(()=>[l("div",Ce,[d(m,{variant:"secondary",onClick:e[5]||(e[5]=t=>y.value=!1)},{default:r(()=>[...e[23]||(e[23]=[n("Cancel",-1)])]),_:1}),d(m,{loading:g.value,onClick:U},{default:r(()=>[n(x(f.value?"Save Changes":"Add Character"),1)]),_:1},8,["loading"])])]),default:r(()=>[l("form",{onSubmit:W(U,["prevent"]),class:"space-y-4"},[l("div",null,[e[16]||(e[16]=l("label",{class:"block text-xs text-text-muted mb-1"},"Character Name *",-1)),A(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>s.name=t),required:"",placeholder:"Arthas",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},null,512),[[T,s.name]])]),l("div",null,[e[18]||(e[18]=l("label",{class:"block text-xs text-text-muted mb-1"},"Class *",-1)),A(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.class=t),required:"",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},[e[17]||(e[17]=l("option",{value:""},"Select class…",-1)),(o(),c(S,null,$(B,t=>l("option",{key:t,value:t},x(t),9,ye)),64))],512),[[N,s.class]])]),l("div",null,[e[19]||(e[19]=l("label",{class:"block text-xs text-text-muted mb-1"},"Realm *",-1)),A(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.realm=t),required:"",placeholder:"Icecrown",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},null,512),[[T,s.realm]])]),l("div",null,[e[21]||(e[21]=l("label",{class:"block text-xs text-text-muted mb-1"},"Role",-1)),A(l("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.role=t),class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},[...e[20]||(e[20]=[l("option",{value:""},"Select role…",-1),l("option",{value:"tank"},"Tank",-1),l("option",{value:"healer"},"Healer",-1),l("option",{value:"dps"},"DPS",-1)])],512),[[N,s.role]])]),l("div",null,[e[22]||(e[22]=l("label",{class:"block text-xs text-text-muted mb-1"},"Spec",-1)),A(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.spec=t),placeholder:"e.g. Frost, Holy…",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none"},null,512),[[T,s.spec]])]),p.value?(o(),c("div",ke,x(p.value),1)):_("",!0)],32)]),_:1},8,["modelValue","title"]),d(j,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=t=>C.value=t),title:"Archive Character",size:"sm"},{footer:r(()=>[l("div",Ae,[d(m,{variant:"secondary",onClick:e[7]||(e[7]=t=>C.value=!1)},{default:r(()=>[...e[26]||(e[26]=[n("Cancel",-1)])]),_:1}),d(m,{variant:"danger",loading:g.value,onClick:H},{default:r(()=>[...e[27]||(e[27]=[n("Archive",-1)])]),_:1},8,["loading"])])]),default:r(()=>{var t;return[l("p",we,[e[24]||(e[24]=n("Archive ",-1)),l("strong",_e,x((t=M.value)==null?void 0:t.name),1),e[25]||(e[25]=n("? They will no longer appear in signups.",-1))])]}),_:1},8,["modelValue"])]),_:1}))}};export{Ne as default};
