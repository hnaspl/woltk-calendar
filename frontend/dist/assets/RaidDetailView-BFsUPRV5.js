import{x as D,o as a,c as v,a as e,g as U,t as m,y as G,k as H,q as ee,l as T,w as C,d as w,e as te,f as q,F as B,m as M,z as W,b as S,v as J,r as L,A as se,u as V,i as k,B as le,n as ae,p as R,h as K,C as ne}from"./index-B2-RunWW.js";import{u as Q,a as oe,A as re}from"./AppShell-CflNe7-M.js";import{_ as F}from"./WowCard-Cmy-HL6C.js";import{_ as E}from"./WowButton-B3DY_ja0.js";import{_ as ie}from"./WowModal-CCoTxtnT.js";import{_ as X}from"./StatusBadge-iRNFSn9z.js";import{_ as ue,a as de}from"./RealmBadge-CFQI9HTC.js";import{g as ce,_ as O,a as pe}from"./SpecBadge-CY34S-s7.js";import{_ as Y}from"./ClassBadge-CR9v84wO.js";import{_ as me}from"./WowTooltip-D3rLtXsf.js";import{u as P}from"./useWowIcons-CHrwIOWq.js";import{a as ve,u as ge,l as fe,c as xe,b as be}from"./events-CGIxMRf0.js";const he=(c,g)=>D.get(`/guilds/${c}/events/${g}/signups`),ye=(c,g,o)=>D.post(`/guilds/${c}/events/${g}/signups`,o),_e=(c,g,o,I)=>D.put(`/guilds/${c}/events/${g}/signups/${o}`,I),ke={key:0,class:"w-3 h-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},we={key:1,class:"w-3 h-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},$e={__name:"LockBadge",props:{locked:{type:Boolean,default:!1}},setup(c){return(g,o)=>(a(),v("span",{class:G(["inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium border",c.locked?"text-red-300 bg-red-500/10 border-red-500/30":"text-green-300 bg-green-500/10 border-green-500/30"])},[c.locked?(a(),v("svg",ke,[...o[0]||(o[0]=[e("path",{"fill-rule":"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z","clip-rule":"evenodd"},null,-1)])])):(a(),v("svg",we,[...o[1]||(o[1]=[e("path",{d:"M10 2a5 5 0 00-5 5v2a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2H7V7a3 3 0 015.905-.75 1 1 0 001.937-.5A5.002 5.002 0 0010 2z"},null,-1)])])),U(" "+m(c.locked?"Locked":"Open"),1)],2))}},Se={key:0,class:"mb-4 p-3 rounded bg-red-900/30 border border-red-600 text-red-300 text-sm"},Ce={key:1,class:"mb-4 p-3 rounded bg-green-900/30 border border-green-600 text-green-300 text-sm"},Ie=["value"],ze={class:"flex gap-2"},Te=["onClick"],Ne={__name:"SignupForm",props:{eventId:{type:[Number,String],required:!0},guildId:{type:[Number,String],required:!0},existingSignup:{type:Object,default:null}},emits:["signed-up","updated"],setup(c,{emit:g}){const o=c,I=g,x=L([]),r=L(!1),b=L(null),t=L(!1),l=[{value:"tank"},{value:"healer"},{value:"dps"}],s=se({characterId:"",chosenRole:"dps",chosenSpec:"",status:"going",note:""});H(async()=>{try{x.value=await ce(o.guildId)}catch{}}),ee(()=>o.existingSignup,f=>{f&&(s.characterId=f.character_id??"",s.chosenRole=f.chosen_role??"dps",s.chosenSpec=f.chosen_spec??"",s.status=f.status??"going",s.note=f.note??"")},{immediate:!0});async function _(){var i,d;if(!s.characterId){b.value="Please select a character";return}if(!s.chosenRole){b.value="Please select a role";return}b.value=null,t.value=!1,r.value=!0;const f={character_id:s.characterId,chosen_role:s.chosenRole,chosen_spec:s.chosenSpec||void 0,status:s.status,note:s.note||void 0};try{if(o.existingSignup){const A=await _e(o.guildId,o.eventId,o.existingSignup.id,f);I("updated",A)}else{const A=await ye(o.guildId,o.eventId,f);I("signed-up",A)}t.value=!0,setTimeout(()=>{t.value=!1},3e3)}catch(A){b.value=((d=(i=A==null?void 0:A.response)==null?void 0:i.data)==null?void 0:d.message)??"Failed to submit signup"}finally{r.value=!1}}return(f,i)=>(a(),T(F,null,{default:C(()=>[i[11]||(i[11]=e("h3",{class:"wow-heading text-base mb-4"},"Sign Up",-1)),b.value?(a(),v("div",Se,m(b.value),1)):w("",!0),t.value?(a(),v("div",Ce," Signed up successfully! ")):w("",!0),e("form",{onSubmit:te(_,["prevent"]),class:"space-y-4"},[e("div",null,[i[5]||(i[5]=e("label",{class:"block text-xs text-text-muted mb-1"},"Character *",-1)),q(e("select",{"onUpdate:modelValue":i[0]||(i[0]=d=>s.characterId=d),class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none",required:""},[i[4]||(i[4]=e("option",{value:""},"Select characterâ€¦",-1)),(a(!0),v(B,null,M(x.value,d=>(a(),v("option",{key:d.id,value:d.id},m(d.name)+" ("+m(d.class)+" â€“ "+m(d.realm)+") ",9,Ie))),128))],512),[[W,s.characterId]])]),e("div",null,[i[6]||(i[6]=e("label",{class:"block text-xs text-text-muted mb-1"},"Role *",-1)),e("div",ze,[(a(),v(B,null,M(l,d=>e("button",{key:d.value,type:"button",class:G(["flex-1 flex items-center justify-center gap-1.5 py-2 rounded border text-sm transition-all",s.chosenRole===d.value?"bg-accent-gold/10 border-accent-gold text-accent-gold":"border-border-default text-text-muted hover:border-border-gold hover:text-text-primary"]),onClick:A=>s.chosenRole=d.value},[S(O,{role:d.value},null,8,["role"])],10,Te)),64))])]),e("div",null,[i[7]||(i[7]=e("label",{class:"block text-xs text-text-muted mb-1"},"Spec",-1)),q(e("input",{"onUpdate:modelValue":i[1]||(i[1]=d=>s.chosenSpec=d),type:"text",placeholder:"e.g. Holy, Frost, Balanceâ€¦",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none placeholder:text-text-muted/50"},null,512),[[J,s.chosenSpec]])]),e("div",null,[i[9]||(i[9]=e("label",{class:"block text-xs text-text-muted mb-1"},"Status *",-1)),q(e("select",{"onUpdate:modelValue":i[2]||(i[2]=d=>s.status=d),class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none",required:""},[...i[8]||(i[8]=[e("option",{value:"going"},"Going âœ“",-1),e("option",{value:"tentative"},"Tentative ?",-1),e("option",{value:"declined"},"Declined âœ—",-1),e("option",{value:"late"},"Late â§–",-1),e("option",{value:"bench"},"Bench",-1)])],512),[[W,s.status]])]),e("div",null,[i[10]||(i[10]=e("label",{class:"block text-xs text-text-muted mb-1"},"Note",-1)),q(e("textarea",{"onUpdate:modelValue":i[3]||(i[3]=d=>s.note=d),rows:"2",placeholder:"Optional noteâ€¦",class:"w-full bg-bg-tertiary border border-border-default text-text-primary rounded px-3 py-2 text-sm focus:border-border-gold outline-none resize-none placeholder:text-text-muted/50"},null,512),[[J,s.note]])]),S(E,{type:"submit",loading:r.value,class:"w-full"},{default:C(()=>[U(m(c.existingSignup?"Update Signup":"Sign Up"),1)]),_:1},8,["loading"])],32)]),_:1}))}},Ae={class:"flex items-center justify-between mb-4"},Le={class:"text-sm text-text-muted"},Re={key:0,class:"text-center py-6 text-text-muted text-sm"},Ue={key:0,class:"mb-5"},Ve={class:"flex items-center gap-2 mb-2"},Be={class:"text-xs text-text-muted"},Ee={class:"space-y-1.5"},Me=["src","alt"],je={key:1,class:"w-7 h-7 rounded bg-bg-secondary flex-shrink-0"},De={class:"flex-1 min-w-0"},Fe={class:"text-sm font-medium text-text-primary truncate"},qe={class:"flex items-center gap-1.5 mt-0.5 flex-wrap"},Ge={__name:"SignupList",props:{signups:{type:Array,default:()=>[]}},setup(c){const g=c,{getClassIcon:o}=P(),I=["going","tentative","late","bench","declined"],x=k(()=>I.map(r=>({status:r,items:g.signups.filter(b=>b.status===r)})));return(r,b)=>(a(),T(F,null,{default:C(()=>[e("div",Ae,[b[0]||(b[0]=e("h3",{class:"wow-heading text-base"},"Signups",-1)),e("span",Le,m(c.signups.length)+" total",1)]),c.signups.length===0?(a(),v("div",Re," No signups yet. ")):w("",!0),(a(!0),v(B,null,M(x.value,t=>(a(),v(B,{key:t.status},[t.items.length>0?(a(),v("div",Ue,[e("div",Ve,[S(X,{status:t.status},null,8,["status"]),e("span",Be,"("+m(t.items.length)+")",1)]),e("div",Ee,[(a(!0),v(B,null,M(t.items,l=>{var s,_,f;return a(),v("div",{key:l.id,class:"flex items-center gap-3 px-3 py-2 rounded-lg bg-bg-tertiary/60 hover:bg-bg-tertiary transition-colors"},[(s=l.character)!=null&&s.class?(a(),v("img",{key:0,src:V(o)(l.character.class),alt:l.character.class,class:"w-7 h-7 rounded border border-border-default flex-shrink-0"},null,8,Me)):(a(),v("div",je)),e("div",De,[e("div",Fe,m(((_=l.character)==null?void 0:_.name)??"Unknown"),1),e("div",qe,[(f=l.character)!=null&&f.class?(a(),T(Y,{key:0,"class-name":l.character.class},null,8,["class-name"])):w("",!0),l.chosen_role?(a(),T(O,{key:1,role:l.chosen_role},null,8,["role"])):w("",!0),l.chosen_spec?(a(),T(pe,{key:2,spec:l.chosen_spec},null,8,["spec"])):w("",!0)])]),l.note?(a(),T(me,{key:2,text:l.note,position:"left"},{default:C(()=>[...b[1]||(b[1]=[e("svg",{class:"w-4 h-4 text-text-muted flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1)])]),_:1},8,["text"])):w("",!0)])}),128))])])):w("",!0)],64))),128))]),_:1}))}},He={key:0,class:"text-center py-4 text-text-muted text-sm"},Oe={key:1,class:"space-y-4"},Pe={class:"flex items-center justify-between mb-1.5"},We={class:"flex items-center gap-2"},Je={class:"text-sm text-text-primary font-medium"},Ke={class:"text-xs text-text-muted"},Qe={class:"w-full h-2 bg-bg-tertiary rounded-full overflow-hidden"},Xe={class:"flex items-center justify-between text-sm"},Ye={class:"text-text-primary font-bold"},Ze={__name:"CompositionSummary",props:{signups:{type:Array,default:()=>[]},maxSize:{type:Number,default:null},tankSlots:{type:Number,default:2},healerSlots:{type:Number,default:5},dpsSlots:{type:Number,default:18}},setup(c){const g=c,o=k(()=>g.signups.filter(t=>["going","tentative"].includes(t.status))),I=k(()=>o.value.length),x=k(()=>g.signups.filter(t=>t.status==="going").length);function r(t){return o.value.filter(l=>l.chosen_role===t).length}const b=k(()=>[{name:"tank",count:r("tank"),target:g.tankSlots,barClass:"bg-blue-400"},{name:"healer",count:r("healer"),target:g.healerSlots,barClass:"bg-green-400"},{name:"dps",count:r("dps"),target:g.dpsSlots,barClass:"bg-red-400"}]);return(t,l)=>(a(),T(F,null,{default:C(()=>[l[2]||(l[2]=e("h3",{class:"wow-heading text-base mb-4"},"Composition",-1)),I.value===0?(a(),v("div",He," No confirmed signups yet. ")):(a(),v("div",Oe,[(a(!0),v(B,null,M(b.value,s=>(a(),v("div",{key:s.name},[e("div",Pe,[e("div",We,[S(O,{role:s.name},null,8,["role"]),e("span",Je,m(s.count),1),e("span",Ke,"/ "+m(s.target),1)]),e("span",{class:G(["text-xs font-semibold",s.count>=s.target?"text-green-400":"text-yellow-400"])},m(s.count>=s.target?"âœ“ Full":`${s.target-s.count} needed`),3)]),e("div",Qe,[e("div",{class:G(["h-full rounded-full transition-all duration-500",s.barClass]),style:le({width:`${Math.min(100,s.count/Math.max(s.target,1)*100)}%`})},null,6)])]))),128)),l[1]||(l[1]=e("hr",{class:"gold-divider"},null,-1)),e("div",Xe,[l[0]||(l[0]=e("span",{class:"text-text-muted"},"Total confirmed",-1)),e("span",Ye,m(x.value)+" / "+m(c.maxSize??"?"),1)])]))]),_:1}))}},et=(c,g)=>D.get(`/guilds/${c}/events/${g}/lineup`),tt=(c,g,o)=>D.put(`/guilds/${c}/events/${g}/lineup`,o),st={class:"flex items-center justify-between px-5 py-3 border-b border-border-default"},lt={class:"flex items-center gap-2"},at={class:"grid grid-cols-1 md:grid-cols-3 gap-px bg-border-default"},nt={class:"bg-bg-secondary p-4"},ot={class:"flex items-center gap-2 mb-3"},rt={class:"ml-auto text-xs text-text-muted"},it={class:"bg-bg-secondary p-4"},ut={class:"flex items-center gap-2 mb-3"},dt={class:"ml-auto text-xs text-text-muted"},ct={class:"bg-bg-secondary p-4"},pt={class:"flex items-center gap-2 mb-3"},mt={class:"ml-auto text-xs text-text-muted"},vt={key:0,class:"px-5 py-4 border-t border-border-default"},gt={class:"text-xs text-text-muted mb-2 uppercase tracking-wider"},ft={class:"flex flex-wrap gap-2"},xt={class:"text-text-muted"},bt={__name:"LineupBoard",props:{signups:{type:Array,default:()=>[]},eventId:{type:[Number,String],required:!0},guildId:{type:[Number,String],required:!0},tankSlots:{type:Number,default:2},healerSlots:{type:Number,default:5},dpsSlots:{type:Number,default:18}},emits:["saved"],setup(c,{emit:g}){const o=c,I=g,x=L(!1),r=L({tanks:[],healers:[],dps:[]});H(async()=>{try{const u=await et(o.guildId,o.eventId);r.value.tanks=u.tanks??[],r.value.healers=u.healers??[],r.value.dps=u.dps??[]}catch{}});const b=k(()=>o.signups.filter(u=>["going","tentative"].includes(u.status))),t=k(()=>{const u=new Set;return[...r.value.tanks,...r.value.healers,...r.value.dps].forEach(n=>u.add(n.id)),u}),l=k(()=>b.value.filter(u=>!t.value.has(u.id))),s=k(()=>l.value.filter(u=>u.chosen_role==="tank")),_=k(()=>l.value.filter(u=>u.chosen_role==="healer")),f=k(()=>l.value.filter(u=>u.chosen_role==="dps"));function i(u,n){r.value[u].push(n)}function d(u,n){r.value[u].splice(n,1)}async function A(){x.value=!0;try{await tt(o.guildId,o.eventId,{tanks:r.value.tanks.map(u=>u.id),healers:r.value.healers.map(u=>u.id),dps:r.value.dps.map(u=>u.id)}),I("saved",r.value)}catch(u){console.error("Failed to save lineup",u)}finally{x.value=!1}}const j=ae({name:"LineupColumn",props:{role:{type:String,required:!0},slots:{type:Array,default:()=>[]},signups:{type:Array,default:()=>[]}},emits:["assign","remove"],setup(u,{emit:n}){const{getClassIcon:y}=P();return()=>R("div",{class:"space-y-1.5"},[...u.slots.map(($,N)=>{var h,p,z;return R("div",{key:$.id,class:"flex items-center gap-2 px-2 py-1.5 rounded bg-bg-primary border border-border-default group"},[R("img",{src:y((h=$.character)==null?void 0:h.class),alt:((p=$.character)==null?void 0:p.class)??"",class:"w-6 h-6 rounded flex-shrink-0",loading:"lazy"}),R("span",{class:"flex-1 text-xs text-text-primary truncate"},((z=$.character)==null?void 0:z.name)??"?"),R("button",{type:"button",class:"opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-300 transition-all",onClick:()=>n("remove",N)},"Ã—")])}),u.signups.length>0?R("select",{class:"w-full bg-bg-tertiary border border-dashed border-border-default text-text-muted text-xs rounded px-2 py-1.5 mt-1 focus:border-border-gold outline-none",onChange:$=>{const N=u.signups.find(h=>String(h.id)===$.target.value);N&&(n("assign",N),$.target.value="")}},[R("option",{value:""},"+ Add playerâ€¦"),...u.signups.map($=>{var N;return R("option",{key:$.id,value:$.id},`${((N=$.character)==null?void 0:N.name)??"?"} (${$.chosen_spec||$.chosen_role})`)})]):null])}});return(u,n)=>(a(),T(F,{padded:!1},{default:C(()=>[e("div",st,[n[7]||(n[7]=e("h3",{class:"wow-heading text-base"},"Lineup Board",-1)),e("div",lt,[S(E,{variant:"secondary",onClick:A,loading:x.value,class:"text-xs py-1 px-3"},{default:C(()=>[...n[6]||(n[6]=[U(" Save Lineup ",-1)])]),_:1},8,["loading"])])]),e("div",at,[e("div",nt,[e("div",ot,[n[8]||(n[8]=e("img",{src:"https://wow.zamimg.com/images/wow/icons/medium/ability_warrior_defensivestance.jpg",class:"w-5 h-5 rounded",alt:"Tank"},null,-1)),n[9]||(n[9]=e("span",{class:"text-blue-300 font-semibold text-sm"},"Tanks",-1)),e("span",rt,m(r.value.tanks.length)+" / "+m(c.tankSlots),1)]),S(V(j),{role:"tank",slots:r.value.tanks,signups:s.value,onAssign:n[0]||(n[0]=y=>i("tanks",y)),onRemove:n[1]||(n[1]=y=>d("tanks",y))},null,8,["slots","signups"])]),e("div",it,[e("div",ut,[n[10]||(n[10]=e("img",{src:"https://wow.zamimg.com/images/wow/icons/medium/spell_holy_flashheal.jpg",class:"w-5 h-5 rounded",alt:"Healer"},null,-1)),n[11]||(n[11]=e("span",{class:"text-green-300 font-semibold text-sm"},"Healers",-1)),e("span",dt,m(r.value.healers.length)+" / "+m(c.healerSlots),1)]),S(V(j),{role:"healer",slots:r.value.healers,signups:_.value,onAssign:n[2]||(n[2]=y=>i("healers",y)),onRemove:n[3]||(n[3]=y=>d("healers",y))},null,8,["slots","signups"])]),e("div",ct,[e("div",pt,[n[12]||(n[12]=e("img",{src:"https://wow.zamimg.com/images/wow/icons/medium/ability_dualwield.jpg",class:"w-5 h-5 rounded",alt:"DPS"},null,-1)),n[13]||(n[13]=e("span",{class:"text-red-300 font-semibold text-sm"},"DPS",-1)),e("span",mt,m(r.value.dps.length)+" / "+m(c.dpsSlots),1)]),S(V(j),{role:"dps",slots:r.value.dps,signups:f.value,onAssign:n[4]||(n[4]=y=>i("dps",y)),onRemove:n[5]||(n[5]=y=>d("dps",y))},null,8,["slots","signups"])])]),l.value.length>0?(a(),v("div",vt,[e("p",gt,"Unassigned ("+m(l.value.length)+")",1),e("div",ft,[(a(!0),v(B,null,M(l.value,y=>{var $,N;return a(),v("div",{key:y.id,class:"flex items-center gap-1.5 px-2 py-1 rounded bg-bg-tertiary border border-border-default text-xs cursor-pointer hover:border-border-gold transition-colors"},[($=y.character)!=null&&$.class?(a(),T(Y,{key:0,"class-name":y.character.class},null,8,["class-name"])):w("",!0),e("span",null,m(((N=y.character)==null?void 0:N.name)??"?"),1),e("span",xt,"("+m(y.chosen_role)+")",1)])}),128))])])):w("",!0)]),_:1}))}};function ht(){const c=K(),g=Q(),o=k(()=>c.user),I=k(()=>g.currentGuild),x=k(()=>!o.value||!I.value?null:g.members.find(f=>f.user_id===o.value.id)??null),r=k(()=>{var _;return((_=x.value)==null?void 0:_.role)??"member"}),b=k(()=>{var _;return((_=o.value)==null?void 0:_.is_admin)===!0||r.value==="admin"}),t=k(()=>b.value||r.value==="officer"),l=k(()=>!!x.value);function s(_){switch(_){case"manage_guild":return b.value;case"manage_events":return t.value;case"manage_lineup":return t.value;case"manage_members":return t.value;case"view_attendance":return l.value;case"record_attendance":return t.value;case"sign_up":return l.value;default:return!1}}return{membership:x,role:r,isAdmin:b,isOfficer:t,isMember:l,can:s}}const yt={class:"p-4 md:p-6 space-y-6"},_t={key:0,class:"space-y-4"},kt={key:1,class:"p-4 rounded-lg bg-red-900/30 border border-red-600 text-red-300"},wt={class:"flex flex-col sm:flex-row items-start gap-4"},$t=["src","alt"],St={class:"flex-1 min-w-0"},Ct={class:"flex items-center gap-2 flex-wrap mb-2"},It={class:"wow-heading text-xl"},zt={class:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-text-muted"},Tt={key:0},Nt={key:0,class:"mt-3 text-sm text-text-muted"},At={key:0,class:"flex flex-wrap gap-2 flex-shrink-0"},Lt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Rt={class:"space-y-6"},Ut={class:"lg:col-span-2 space-y-6"},Vt={class:"flex justify-end gap-3"},Jt={__name:"RaidDetailView",setup(c){const g=ne(),o=Q(),I=K(),x=oe(),r=ht(),{getRaidIcon:b}=P(),t=L(null),l=L([]),s=L(!0),_=L(null),f=L(!1),i=L(!1),d=k(()=>{var h;return(h=o.currentGuild)==null?void 0:h.id}),A=k(()=>I.user?l.value.find(h=>h.user_id===I.user.id)??null:null);H(async()=>{var h,p;s.value=!0,_.value=null;try{o.currentGuild||await o.fetchGuilds();const[z,Z]=await Promise.all([ve(d.value,g.params.id),he(d.value,g.params.id)]);t.value=z,l.value=Z}catch(z){_.value=((p=(h=z==null?void 0:z.response)==null?void 0:h.data)==null?void 0:p.message)??"Failed to load raid details"}finally{s.value=!1}});async function j(){if(t.value){f.value=!0;try{t.value.is_locked?(await ge(d.value,t.value.id),t.value.is_locked=!1):(await fe(d.value,t.value.id),t.value.is_locked=!0),x.showToast(`Event ${t.value.is_locked?"locked":"unlocked"}`,"success")}catch{x.showToast("Action failed","error")}finally{f.value=!1}}}async function u(){f.value=!0;try{await xe(d.value,t.value.id),t.value.status="completed",x.showToast("Event marked as completed!","success")}catch{x.showToast("Failed to complete event","error")}finally{f.value=!1}}async function n(){f.value=!0;try{await be(d.value,t.value.id),t.value.status="cancelled",i.value=!1,x.showToast("Event cancelled","warning")}catch{x.showToast("Failed to cancel event","error")}finally{f.value=!1}}function y(h){l.value.push(h),x.showToast("Signed up successfully!","success")}function $(h){const p=l.value.findIndex(z=>z.id===h.id);p!==-1&&(l.value[p]=h),x.showToast("Signup updated!","success")}function N(h){return h?new Date(h).toLocaleString("en-GB",{weekday:"long",day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"?"}return(h,p)=>(a(),T(re,null,{default:C(()=>[e("div",yt,[s.value?(a(),v("div",_t,[...p[4]||(p[4]=[e("div",{class:"h-32 rounded-lg bg-bg-secondary border border-border-default loading-pulse"},null,-1),e("div",{class:"h-64 rounded-lg bg-bg-secondary border border-border-default loading-pulse"},null,-1)])])):_.value?(a(),v("div",kt,m(_.value),1)):t.value?(a(),v(B,{key:2},[S(F,{gold:!0},{default:C(()=>[e("div",wt,[e("img",{src:V(b)(t.value.raid_type),alt:t.value.raid_type,class:"w-20 h-20 rounded-lg border border-border-gold shadow-gold flex-shrink-0"},null,8,$t),e("div",St,[e("div",Ct,[e("h1",It,m(t.value.title),1),t.value.size?(a(),T(ue,{key:0,size:t.value.size},null,8,["size"])):w("",!0),S(X,{status:t.value.status??"open"},null,8,["status"]),S($e,{locked:t.value.is_locked},null,8,["locked"])]),e("div",zt,[e("span",null,"ðŸ“… "+m(N(t.value.start_time??t.value.date)),1),t.value.end_time?(a(),v("span",Tt,"â†’ "+m(N(t.value.end_time)),1)):w("",!0),t.value.realm?(a(),T(de,{key:1,realm:t.value.realm},null,8,["realm"])):w("",!0)]),t.value.description?(a(),v("p",Nt,m(t.value.description),1)):w("",!0)]),V(r).isOfficer.value?(a(),v("div",At,[S(E,{variant:"secondary",onClick:j},{default:C(()=>[U(m(t.value.is_locked?"Unlock":"Lock"),1)]),_:1}),t.value.status!=="completed"?(a(),T(E,{key:0,variant:"primary",onClick:u},{default:C(()=>[...p[5]||(p[5]=[U(" Mark Done ",-1)])]),_:1})):w("",!0),S(E,{variant:"danger",onClick:p[0]||(p[0]=z=>i.value=!0)},{default:C(()=>[...p[6]||(p[6]=[U("Cancel Event",-1)])]),_:1})])):w("",!0)])]),_:1}),e("div",Lt,[e("div",Rt,[t.value.status==="open"?(a(),T(Ne,{key:0,"event-id":t.value.id,"guild-id":d.value,"existing-signup":A.value,onSignedUp:y,onUpdated:$},null,8,["event-id","guild-id","existing-signup"])):w("",!0),S(Ze,{signups:l.value,"max-size":t.value.size,"tank-slots":t.value.tank_slots??2,"healer-slots":t.value.healer_slots??5,"dps-slots":t.value.dps_slots??18},null,8,["signups","max-size","tank-slots","healer-slots","dps-slots"])]),e("div",Ut,[S(Ge,{signups:l.value},null,8,["signups"]),V(r).isOfficer.value?(a(),T(bt,{key:0,signups:l.value,"event-id":t.value.id,"guild-id":d.value,"tank-slots":t.value.tank_slots??2,"healer-slots":t.value.healer_slots??5,"dps-slots":t.value.dps_slots??18,onSaved:p[1]||(p[1]=z=>V(x).showToast("Lineup saved!","success"))},null,8,["signups","event-id","guild-id","tank-slots","healer-slots","dps-slots"])):w("",!0)])])],64)):w("",!0)]),S(ie,{modelValue:i.value,"onUpdate:modelValue":p[3]||(p[3]=z=>i.value=z),title:"Cancel Event",size:"sm"},{footer:C(()=>[e("div",Vt,[S(E,{variant:"secondary",onClick:p[2]||(p[2]=z=>i.value=!1)},{default:C(()=>[...p[7]||(p[7]=[U("Nevermind",-1)])]),_:1}),S(E,{variant:"danger",loading:f.value,onClick:n},{default:C(()=>[...p[8]||(p[8]=[U("Cancel Event",-1)])]),_:1},8,["loading"])])]),default:C(()=>[p[9]||(p[9]=e("p",{class:"text-text-muted mb-4"},"Are you sure you want to cancel this event? This cannot be undone.",-1))]),_:1},8,["modelValue"])]),_:1}))}};export{Jt as default};
